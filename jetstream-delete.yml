---
- hosts: localhost
  vars_files:
    vars/jetstream.yml
  tasks:

    - name: Get IP address assgined for galaxy instance 
      openstack.cloud.server_info:
        server: "{{ instance_name }}"
      register: server_info

    # - debug:
        # msg: "{{ server_info.openstack_servers[0].accessIPv4 }}"

    - name: Delete Jetstream instance for galaxy
      os_server:
        name: "{{ instance_name }}"
        state: absent
      ignore_errors: true

    - name: Remove SSH key for the server
      command: "ssh-keygen -R {{ server_info.openstack_servers[0].accessIPv4 }}"
      ignore_errors: true

    - name: Delete Jetstream instance for galaxy services
      os_server:
        name: "{{ instance_name }}-services"
        state: absent
      ignore_errors: true

